<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>To-Do List</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
  :root{
    --bg:#0b0d12;     
    --bg-2:#161922;      
    --bg-3:#1e2230;      
    --fg:#f4f6fb;         
    --muted:#c3c8d4;      
    --border:#2b3142;    
    --accent:#4c7dff;    
    --accent-hover:#3b67d6;
    --ok:#25b06b;         
    --ok-hover:#1f945a;
    --warn:#d84b57;       
    --warn-hover:#bd404a;
    --chip:#424a64;      
  }

  body{ background:var(--bg); color:var(--fg); }
  .container{ max-width:720px; margin-top:28px; }
  .intro-text{ text-align:center; font-size:.98rem; color:var(--muted); margin:6px 0 16px; }

  .card{ background:var(--bg-2); border-color:var(--border); }
  .list-group-item{ background:var(--bg-2); color:var(--fg); border-color:var(--border); }
  .list-group-item.text-muted, .text-muted{ color:#d8dbe4 !important; }

  .task-item{ border-left:8px solid var(--task-color,#6c757d); }
  .task-done{ color:#aeb4c4 !important; text-decoration:line-through; }
  .color-dot{ display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; vertical-align:middle; box-shadow:0 0 0 1px rgba(255,255,255,.18); }

  .form-control,
  .form-select,
  .input-group-text{
    min-width:0;
    background:var(--bg-3);
    color:var(--fg);
    border-color:var(--border);
  }
  .form-control:focus,
  .form-select:focus{
    background:var(--bg-3);
    color:var(--fg);
    border-color:#5a6aa0;
    box-shadow:none;
  }
  .form-control::placeholder{ color:#a7afc2; }
  .form-select{ text-align-last:center; }

  .section-title{ font-size:1rem; font-weight:700; color:#ffffff; text-align:center; }

  .stack-8 > * + *{ margin-top:.5rem; }
  .stack-12 > * + *{ margin-top:.75rem; }

  .btn:focus, .btn:active{ box-shadow:none !important; }
  .btn-wide{ width:100%; }
  .btn-primary{ background:var(--accent); border-color:var(--accent); color:#fff; }
  .btn-primary:hover{ background:var(--accent-hover); border-color:var(--accent-hover); }
  .btn-secondary{ background:var(--chip); border-color:var(--chip); color:#eef1f8; }
  .btn-secondary:hover{ filter:brightness(1.05); }
  .btn-success{ background:var(--ok); border-color:var(--ok); }
  .btn-success:hover{ background:var(--ok-hover); border-color:var(--ok-hover); }
  .btn-danger{ background:var(--warn); border-color:var(--warn); }
  .btn-danger:hover{ background:var(--warn-hover); border-color:var(--warn-hover); }
  .btn-outline-light{ color:#f2f4fb; border-color:#6c7696; }
  .btn-outline-light:hover{ background:#2a3042; }

  .badge.bg-secondary{ background:var(--chip) !important; color:#f0f3fa !important; }
  .badge.bg-danger{ background:var(--warn) !important; color:#fff !important; }

  .fmt-group .btn{ background:var(--bg-3); border-color:var(--border); color:var(--fg); }
  .fmt-group .btn:hover{ filter:brightness(1.07); }
  .fmt-group .btn-check:checked + .btn{ background:#2a3146; border-color:#5a6aa0; }

  .task-actions .btn{ min-width:42px; }

  @media (min-width:576px){
    .section-title{ text-align:left; }

  .form-label {
    color: #dfe3ec !important;   
    font-weight: 500;            
  }

  .fmt-group .btn-check:checked + .btn {
    background-color: #3a6df0 !important; 
    color: #fff !important;               
    border-color: #3a6df0 !important;
  }
  .fmt-group .btn-check:checked + .btn:hover {
    background-color: #315bd0 !important;
    border-color: #315bd0 !important;
  }
  }
</style>
</head>
<body>
  <div class="container">

    <!-- Header -->
    <h1 class="text-center mb-1">üìù My To-Do List</h1>
    <p class="intro-text">Add a task, pick a due date and category. Use the filter to focus. Manage categories below.</p>

    <div class="card mb-3">
      <div class="card-body">
        <form method="get" class="row g-2 align-items-center">
          <div class="col-12 col-sm">
            <label class="form-label mb-1">Filter by category</label>
            <select name="filter" class="form-select">
              <option value="All" {{ "selected" if selected_filter=="All" else "" }}>All categories</option>
              {% for c in categories %}
                <option value="{{ c }}" {{ "selected" if selected_filter==c else "" }}>{{ c }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-12 col-sm-auto d-grid mt-2 mt-sm-4">
            <button class="btn btn-secondary btn-wide" type="submit">Apply filter</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="section-title m-0">Manage categories</h2>
          <button class="btn btn-outline-light btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#catPanel" aria-expanded="false">Show / Hide</button>
        </div>
        <div id="catPanel" class="collapse show">
          <div class="row g-2">
            <div class="col-12 col-md-7">
              <form action="/add_category" method="post" class="stack-8">
                <label class="form-label mb-1">Create a new category</label>
                <input type="text" name="new_category" class="form-control" placeholder="e.g. School, Work, etc">
                <button class="btn btn-outline-light btn-wide" type="submit">Add category</button>
              </form>
            </div>
            <div class="col-12 col-md-5">
              <form action="/remove_category" method="post" class="stack-8 mt-3 mt-md-0">
                <label class="form-label mb-1">Remove a category</label>
                <select name="remove_category" class="form-select">
                  {% for c in categories %}
                    <option value="{{ c }}">{{ c }}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-danger btn-wide" type="submit">Remove selected</button>
                <div class="text-muted small">‚ÄúGeneral‚Äù cannot be removed. Tasks in a removed category move to ‚ÄúGeneral‚Äù.</div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-body">
        <h2 class="section-title">Add a new task</h2>
        <form action="/add" method="post" class="stack-12">
          <div class="input-group">
            <span class="input-group-text p-0">
              <input type="color" name="color"
                     class="form-control form-control-color border-0"
                     value="{{ default_color }}" title="Choose colour"
                     style="width:3.0rem;height:2.5rem;padding:1;border:none;">
            </span>
            <input type="text" name="task" class="form-control" placeholder="What do you want to do?" required>
          </div>

          <div class="fmt-group d-flex flex-wrap gap-2 justify-content-center">
            <input class="btn-check" id="fmtBold" type="checkbox" name="bold" autocomplete="off">
            <label class="btn btn-sm" for="fmtBold"><strong>B</strong> Bold</label>

            <input class="btn-check" id="fmtItalic" type="checkbox" name="italic" autocomplete="off">
            <label class="btn btn-sm" for="fmtItalic"><em>I</em> Italic</label>

            <input class="btn-check" id="fmtUnderline" type="checkbox" name="underline" autocomplete="off">
            <label class="btn btn-sm" for="fmtUnderline"><span style="text-decoration:underline;">U</span> Underline</label>
          </div>

          <div class="row g-2">
            <div class="col-12 col-sm-6">
              <label class="form-label mb-1">Due</label>
              <input type="datetime-local" name="due" class="form-control" value="{{ default_due_str }}" min="{{ now_str }}">
            </div>
            <div class="col-12 col-sm-6">
              <label class="form-label mb-1">Category</label>
              <select name="category" class="form-select">
                {% for c in categories %}
                  <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <button class="btn btn-primary btn-wide mt-1" type="submit">Add task</button>
        </form>
      </div>
    </div>

    <!-- Tasks List -->
    <div class="card mb-4">
      <div class="card-body">
        <h2 class="section-title">Your tasks</h2>
        <ul class="list-group">
          {% for t in tasks %}
            <li class="list-group-item d-flex justify-content-between align-items-center task-item"
                style="--task-color: {{ t['color'] }};">
              <div class="me-2">
                <span class="{% if t.done %}task-done{% endif %}">
                  <span class="color-dot" style="background-color: {{ t['color'] }};"></span>
                  <span style="
                    {% if t.bold %}font-weight:bold;{% endif %}
                    {% if t.italic %}font-style:italic;{% endif %}
                    {% if t.underline %}text-decoration:underline;{% endif %}
                  ">{{ t["task"] }}</span>
                </span>
                {% if t["due_text"] %}
                  <span class="badge {% if t.overdue %}bg-danger{% else %}bg-secondary{% endif %} ms-2">{{ t["due_text"] }}</span>
                {% endif %}
                <span class="badge bg-secondary ms-2">{{ t["category"] }}</span>
              </div>
              <div class="task-actions d-flex align-items-center">
                {% if not t.done %}
                  <a href="/complete/{{ t['_idx'] }}" class="btn btn-success btn-sm me-1">‚úì</a>
                {% endif %}
                <a href="/delete/{{ t['_idx'] }}" class="btn btn-danger btn-sm">‚úó</a>
              </div>
            </li>
          {% else %}
            <li class="list-group-item text-center text-muted">
              No tasks yet. Add your first one above!
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
